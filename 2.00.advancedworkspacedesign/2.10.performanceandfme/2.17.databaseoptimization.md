# 数据库优化

FME只能与它正在读取或写入的数据库一样快。本节将帮助FME在使用数据库时提高效率。

## 数据库读取

当您可以使用数据库的本机功能时，从数据库中读取和过滤数据（查询）几乎总是更快。正如前面提到的，您可以使用搜索矩形框和WHERE子句来缩小从数据库读取到FME的内容。

---

## 数据库转换器

除了读模块，转换器也可用于查询数据库数据。最好使用的是SQLExecutor（或SQLCreator），因为它们使用本机SQL将查询传递给数据库。如果您不想编写SQL，那么您可以使用FeatureReader转换器，但请注意，此转换器更通用，并且不会提供完全相同的性能。

SQLExecutor特别值得注意，因为它为每个进入要素发出查询。这在您需要进行多次查询时非常有用。

例如，这里为每个进入SQLExecutor的库要素向数据库发出一个查询：

![](../../DesktopAdvanced2WorkspaceDesign/Images/Img2.038.DBPerformanceSQLExecutor.png)

通常，SQLExecutor的输出是一个全新的要素。如果您只想检索要附加到传入要素的属性，那么Joiner转换器更合适。

---

## 数据库写入

从数据库读取的性能很大程度上取决于数据库设置本身，而在写入数据库时​​，有很多FME参数可以帮助微调整体性能。

请记住，写入数据库会导致网络开销。各种组件之间必须保持平衡：

- 发送的数据量和请求数（网络流量）
- 等待传输到数据库的FME存储的数据量（FME性能）
- 等待提交的数据库中存储的数据量（数据库性能）
- 丢失未提交数据的风险

每个数据库写入程序都有一组用于处理这些组件的参数。并非每种格式都支持这些，但两个最常见的参数是_每个事务的要素_和_每个批量写入的要素_。

### 每个批量写入的要素

每个批量写入要素参数告诉FME一次向数据库发送多少要素。

发送到FME数据库读模块的要素将缓存在内存中，直到达到此参数指定的要素数。只有这样他们才会被发送到数据库。这也称为块大小。

此参数是一种平衡网络流量与FME性能的方法。数字越大意味着FME会缓存更多要素（因此使用更多系统资源），但对数据库的请求会减少（因此会减少网络流量）。

数字越小意味着FME缓存的数据越少，但对数据库的请求越多。

每个批量写入的要素也需要考虑每个事务的要素的值。

### 每个事物的要素

每个事务的要素（有时也称为事务间隔）控制在发出提交命令之前将多少要素输入到数据库中。

由FME写模块发送的要素由数据库缓存在内存中，直到达到此参数指定的要素数。只有这样他们才会承诺。

每次提交都会增加写入过程的延迟，因此设置此参数必须平衡转换的速度（更高的数字）与转换可能失败的风险以及需要回滚的要素（较低的数字）。

例如，如果将此参数设置为值1，则会单独提交每个要素。如果进程失败，那么只有最后一个要素将从数据库中丢失，但代价就是大大降低了性能。

或者，如果参数设置为非常高的值（超过正在写入的要素数），则只进行一次提交并提高了性能。但是，如果转换失败，则先前写入的所有要素都将回滚并从数据库中丢失。

如果每个事务的要素小于或等于每个批量写入的要素，则FME基本上会缓存许多要素并将它们发送到立即提交它们的数据库。

如果每个事务的要素大于每个批量写入的要素，则FME将向数据库发送要素，这些要素将被缓存，直到达到事务提交总计。

---

| Jake Speedie说… |
| :--- |
| 事务和块参数可以因格式而异。例如，SQL Server具有单个批量选项标志而不是数字设置。因此，查看FME读模块和写模块手册以确认数据库可用的参数以及它们的运行方式非常重要。 |

---

### 写入和索引

索引可以提高读取数据的性能，而写入则可以大大降低翻译速度。

这是因为数据库通常会使用写入数据库的每个功能自动更新索引。这是基于每个要素发生的，无论提交间隔如何。

为了解决这个问题，建议在将数据批量插入到数据库表之前删除（删除）索引。

写模块要素类型还具有在写入表时截断或丢弃表的选项：

![](../../DesktopAdvanced2WorkspaceDesign/Images/Img2.041.DBPerformanceDropTruncateParams.png)

由于上述原因，丢弃表比截断表更有效，因为drop操作也会删除索引。

出于类似原因，您可能希望在将数据写入地理数据库几何网络时关闭网络连接。 
