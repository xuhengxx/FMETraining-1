# 练习：社区地图转换

 练习2

 社区测绘数据转换项目

数据

社区地图（Esri文件地理数据库）

总体的目标

创建工作空间以将社区地图数据转换为最终用户选择的格式并压缩它

演示

通用写模块，扇出和编写zip文件

启动工作空间

无

结束工作空间

C:\FMEData2018\Workspaces\DesktopAdvanced\ReadWrite-Ex2-Complete.fmw

作为常驻的FME专家，您经常被要求在格式之间转换数据（特别是社区地图）。您意识到如果您创建一个工作空间来执行此操作（无论格式如何）会更简单，并让最终用户自己执行转换。将来，这将很好地用于FME服务器数据下载服务，但是现在，我们将让用户只需在FME Workbench中运行工作空间。

  
**1）启动Workbench**  
启动FME Workbench并从空白画布开始。从菜单栏中选择“读模块”&gt;“添加读模块”并添加以下内容：

读模块格式

Esri地理数据库（File Geodb Open API）

读模块数据集

C：\ FMEData2018 \ DATA \ CommunityMapping \ CommunityMap.gdb

工作流选项

单个合并要素类型

通过选择单个合并的要素类型选项，我们将拥有一个漂亮而紧凑的工作空间，此外它还允许用户选择他们想要从源中读取的表。

单击“确定”关闭对话框并添加读模块。

  
**2）添加写模块**  
从菜单栏选择写模块&gt; 添加写模块并添加通用写模块：

写模块格式

通用（任何格式）

写模块数据集

无

写模块参数

输出格式：Esri Shapefile

添加要素类型

要素类型定义：自动

您不必选择输出位置，但是您必须打开参数对话框并设置原始输出格式; 这样做并选择像Esri Shapefile这样的格式。

在对话框的“添加要素类型”部分中，为要素类型定义选择自动：

单击“确定”，新写模块的“要素类型属性”对话框将自动打开。将Geometry字段设置为fme\_any。这将允许将任何数据写入此要素类型：

单击“确定”关闭对话框并添加新要素类型。将其连接到源要素类型。进行连接时，将自动更新属性模式以匹配连接的读模块要素类型：

  
**3）检查用户参数**  
在导航器窗口中**查看使用**读模块自动创建的用户参数：

SourceDataset\_FILEGDB的参数是我们不需要的（此转换将始终使用相同的数据集），因此请将其删除。

另一个自动创建的参数称为要读取的要素类型。这非常有用，因为当用户运行工作空间时，系统会提示他们选择从源地理数据库中读取的表; 所以保持这个参数。

同样，保留Destination Dataset参数。

输出格式参数很有趣。双击它就像你要设置一个值一样。请注意，下拉列表中的“More Formats ...”选项打开了完整的FME格式列表：

当最终用户不真正需要查看或选择大部分格式时，公开这么多格式是不公平的。限制此列表会更好。因此，删除此用户参数，我们将创建一个新的 - 更具限制性的 - 一个。

  
**4）添加用户参数**  
通过右键单击“用户参数”并选择“创建用户参数”，添加新的用户参数。

在打开的对话框中设置以下内容：

类型

别名选择

名称

输出格式

发布的

是的（选中）

可选的

不（未选中）

提示

选择输出格式：

对于配置字段，单击浏览按钮以打开新对话框。在该对话框中，选择“导入”&gt;“写模块格式”。选择一些最常见的格式，如Esri Shapefile，AutoCAD DWG，GML和MapInfo TAB; 然后单击确定。

然后再单击“确定”两次，直到关闭所有对话框。

  
**5）链接参数**  
现在，在“导航”窗口中，展开“通用写模块”的参数。找到“输出格式”参数。右键单击它，然后选择“链接到用户参数”。

选择新创建的OutputFormat参数，然后单击“确定”：

现在，当工作空间运行时，输出格式的选择将是以下几种：

  
**6）格式属性扇出**  
我们在这里可以做的另一个最终任务是将要素输出到它们的原始表。为此，我们需要知道它们来自何处，并且这是从名为_fme\_feature\_type_的格式属性_获得的_。

检查写模块要素类型的属性。通过选择_fme\_feature\_type_作为提供要素类型名称的属性来设置扇出。

  
**7）保存并运行工作空间**  
保存工作空间，然后使用提示选项集运行它。出现提示时，选择一些要读取的源表（至少包括GarbageSchedule和另外一个）。

然后，对于Destination Generic（任意格式）文件夹，我们将创建一个压缩文件夹以包含我们的所有文件。设置输出文件夹的位置，然后设置结束类型：

```
 \ CommunityMapping.zip 
```

这将创建一个名为CommunityMapping的压缩文件。

最后，将Esri Shapefile设置为要写入的格式。单击“确定”以运行转换

检查输出文件夹。已创建一个压缩文件夹，其中包含已写回Shapefile格式的所有选定表：

现在你有一个解决方案，几乎任何人都可以自己打开和运行。此外，如果您将工作空间发布到FME Server，它将自动创建一个匹配不同用户参数的网页。

 直觉姐姐说......

您是否注意到FME处理了不同的几何类型并输出了几何对象作为名称的一部分？&lt;/font&gt;这是一种Shape格式的东西。FME永远 - 永远不会 - 将多个几何类型写入同一个Shapefile.shp文件。&lt;/font&gt;  
  
一个缺点是每个输出的Shapefile都具有&lt;/font&gt;**所有**源表的&lt;/font&gt;**所有**属性。为避免这种情况，您需要使用动态转换，我们很快就会看到。

&lt;/font&gt;&lt;/font&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt;&lt;/table&gt;

 恭喜

 通过完成本练习，您已学会如何：&lt;/font&gt;

将通用写模块添加到工作空间

设置通用写模块的初始格式

使用Alias参数创建一个选项，提示您输入写模块格式

对通用写模块输出格式使用Choice with Alias参数

在fme\_feature\_type上使用要素类型扇出将要素返回到其原始图层

使用.zip扩展名创建压缩输出数据集

